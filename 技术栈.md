# 技术栈架构文档

这是一个完整的 AI ASMR 视频生成平台技术栈，适用于现代全栈 Web 应用项目复用。

## 🏗️ 核心架构

### 前端框架 (Next.js 14.0.1)
- **Next.js 14.0.1** - React 全栈框架，支持 SSR/SSG
- **React 18.2.0** - 前端 UI 库，支持并发特性
- **TypeScript 5.2.2** - 类型安全的 JavaScript 超集
- **Next-intl 4.3.5** - 国际化解决方案，支持 SSR

### 状态管理与数据获取
- **React Context API** - 轻量级状态管理
- **Supabase SSR (@supabase/ssr)** - 服务端渲染兼容的数据库客户端
- **Axios 1.11.0** - HTTP 客户端，用于第三方 API 集成

## 🎨 UI/UX 技术栈

### 样式框架
- **Tailwind CSS 3.3.5** - 实用优先的 CSS 框架
- **PostCSS** - CSS 处理工具
- **SCSS/Sass 1.69.5** - CSS 预处理器
- **自定义主题** - Primary (蓝色) + Secondary (紫色) 色彩体系

### 交互组件
- **AOS 2.3.4** - 滚动动画库
- **Swiper 11.0.3** - 触摸滑动组件
- **FSLightbox React 1.7.6** - 灯箱/模态框组件
- **React Hot Toast 2.6.0** - 消息提示组件
- **RemixIcon 4.1.0** - 图标库

## 🗄️ 数据存储与后端

### 数据库 (Supabase PostgreSQL)
- **Supabase** - 开源 Firebase 替代方案
- **PostgreSQL** - 关系型数据库
- **Row Level Security (RLS)** - 数据安全策略
- **实时订阅** - 数据变更实时同步

### 核心数据表设计
```sql
user_profiles     # 用户信息和积分管理
videos           # 视频记录和元数据
credit_transactions # 积分交易记录
subscriptions    # 用户订阅管理
orders          # 支付订单记录
blog_posts      # 博客内容管理
categories      # 分类管理
check_in_rewards # 签到奖励系统
```

### 文件存储
- **Cloudflare R2** - 对象存储，S3 兼容
- **AWS SDK v3** - R2 存储客户端
- **Sharp 0.33.0** - 图像处理
- **FFmpeg** - 视频处理和缩略图生成

## 🔧 后端服务架构

### Express.js API 服务器
- **Express 4.18.2** - Node.js Web 框架
- **JWT Authentication** - 基于令牌的身份验证
- **Joi 17.11.0** - 请求参数验证
- **Express Rate Limit** - API 限流中间件
- **Morgan** - HTTP 请求日志
- **Helmet** - 安全头设置
- **CORS** - 跨域资源共享

### 第三方 API 集成
- **KIE API** - AI 视频生成服务 (Runway/VEO3)
- **支付网关** - 在线支付处理
- **Google Cloud Platform** - 云服务集成

## 🛡️ 安全与认证

### 身份验证
- **Supabase Auth** - 用户认证系统
- **Google OAuth** - 社交登录
- **JWT Token Management** - 令牌管理
- **Session Management** - 会话管理

### 安全措施
- **Row Level Security** - 数据库级别权限控制
- **API Key 隔离** - 敏感密钥服务端存储
- **请求验证** - 输入参数严格验证
- **速率限制** - 防止 API 滥用

## 🌐 国际化 (i18n)

### 多语言支持
- **Next-intl 4.3.5** - SSR 兼容的国际化框架
- **支持语言**: 英语 (en)、中文 (zh)、德语 (de)、法语 (fr)
- **动态路由**: `/[locale]/page` 结构
- **翻译文件**: JSON 格式，模块化组织

### SEO 优化
- **多语言 SEO** - 每种语言独立的元数据
- **服务端渲染** - 首屏加载优化
- **动态 Sitemap** - 自动生成站点地图
- **结构化数据** - JSON-LD 格式

## 📱 移动端兼容架构

### 后端 API 架构 (已实现)
- **独立 API 服务器** - Express.js 后端
- **JWT 认证** - 移动端令牌认证
- **安全密钥管理** - 服务端 API 密钥存储
- **移动优化接口** - RESTful API 设计

### 推荐移动技术栈
- **Expo + React Native** - 跨平台移动开发
- **Expo Secure Store** - 安全令牌存储
- **React Navigation** - 移动端路由
- **React Query/SWR** - 数据获取和缓存

## 🔄 视频生成工作流

### KIE API 集成
1. **即时积分扣除** - 20 积分/视频
2. **异步处理** - 回调机制处理生成结果
3. **自动重试** - 网络异常自动重试
4. **失败退款** - 生成失败自动退还积分

### 文件处理流程
1. **视频生成** - KIE API 生成视频
2. **自动下载** - 服务端下载生成结果
3. **缩略图提取** - FFmpeg 提取视频帧
4. **云存储上传** - 上传至 Cloudflare R2
5. **数据库记录** - 保存视频元数据

## 📊 监控与分析

### 性能监控
- **Vercel Analytics** - 访问统计分析
- **Vercel Speed Insights** - 性能指标监控
- **Winston Logger** - 结构化日志记录
- **Error Boundary** - React 错误边界

### 用户行为分析
- **视频使用统计** - 生成、下载、分享追踪
- **积分消费分析** - 用户消费行为统计
- **转化漏斗** - 注册到付费用户转化

## 🚀 部署与运维

### 部署平台
- **前端**: Vercel - 自动 CI/CD，全球 CDN
- **后端 API**: Railway/Vercel Functions - 容器化部署
- **数据库**: Supabase - 托管 PostgreSQL
- **文件存储**: Cloudflare R2 - 全球分布式存储

### 开发工具链
```bash
npm run dev      # 开发服务器
npm run build    # 生产构建
npm run lint     # 代码质量检查
npm run start    # 生产环境启动
```

## 💰 商业化技术栈

### 支付系统
- **多支付网关** - 支持多种支付方式
- **订阅管理** - 周期性订阅处理
- **积分系统** - 虚拟货币管理
- **推荐奖励** - 用户推荐激励机制

### 用户增长
- **推荐系统** - 邀请码追踪
- **签到奖励** - 每日签到积分
- **免费积分** - 新用户激励机制

## 🔧 可复用模块

### 核心业务模块 (100% 可复用)
- `src/lib/kie-veo3-client.ts` - KIE API 客户端
- `src/lib/credits-manager.ts` - 积分管理系统
- `src/lib/r2-upload.ts` - 云存储上传
- `src/lib/video-processor.ts` - 视频处理
- `src/contexts/AuthContext.tsx` - 认证上下文

### 配置文件 (95% 可复用)
- `next.config.js` - Next.js 配置
- `tailwind.config.js` - Tailwind 主题配置
- `tsconfig.json` - TypeScript 配置
- `src/i18n/config.ts` - 国际化配置
- `src/lib/supabase/client.ts` - Supabase 客户端配置

### 数据库模式 (参考价值)
- `database/free_credits_schema.sql` - 免费积分系统架构参考

## 📈 扩展性考虑

### 微服务架构就绪
- **API 网关** - 统一入口管理
- **服务发现** - 动态服务注册
- **负载均衡** - 高可用性保证
- **数据库分片** - 水平扩展支持

### 缓存策略
- **Redis** - 会话和热数据缓存
- **CDN** - 静态资源分发
- **数据库缓存** - 查询结果缓存

---

*最后更新: 2024年 - 基于 AI ASMR 平台实际项目分析*

