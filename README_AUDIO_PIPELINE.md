# ğŸµ ASMR Audio Cloud Pipeline

å®Œæ•´çš„éŸ³é¢‘äº‘ç«¯åŒ–å¤„ç†ç³»ç»Ÿï¼Œå°†æœ¬åœ° MP3 æ–‡ä»¶è½¬æ¢ä¸º AAC æ ¼å¼å¹¶ä¸Šä¼ åˆ° Cloudflare R2ï¼ŒåŒæ—¶è‡ªåŠ¨ç”Ÿæˆå‰ç«¯é…ç½®ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®æ‰§è¡Œå®Œæ•´æµç¨‹
```bash
npm run audio:process
```

### æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
```bash
npm run audio:help
```

## ğŸ“‹ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    éŸ³é¢‘äº‘ç«¯åŒ–å¤„ç†ç³»ç»Ÿ                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. è½¬æ¢å±‚ (convert.js)                                      â”‚
â”‚     â”œâ”€â”€ MP3 â†’ AAC æ ¼å¼è½¬æ¢                                   â”‚
â”‚     â”œâ”€â”€ å‹ç¼©ä¼˜åŒ– (å¹³å‡å‹ç¼©ç‡ 30-50%)                          â”‚
â”‚     â””â”€â”€ æ‰¹é‡å¤„ç†ï¼Œæ”¯æŒé”™è¯¯é‡è¯•                               â”‚
â”‚                                                             â”‚
â”‚  2. å­˜å‚¨å±‚ (upload.js)                                      â”‚
â”‚     â”œâ”€â”€ Cloudflare R2 äº‘ç«¯ä¸Šä¼                                â”‚
â”‚     â”œâ”€â”€ æ–­ç‚¹ç»­ä¼ ï¼Œé‡å¤æ–‡ä»¶æ£€æµ‹                               â”‚
â”‚     â””â”€â”€ ä¸Šä¼ éªŒè¯å’Œå®Œæ•´æ€§æ£€æŸ¥                                 â”‚
â”‚                                                             â”‚
â”‚  3. é…ç½®å±‚ (url-generator.js)                               â”‚
â”‚     â”œâ”€â”€ URL æ˜ å°„ç”Ÿæˆ                                         â”‚
â”‚     â”œâ”€â”€ å‰ç«¯é…ç½®è‡ªåŠ¨æ›´æ–°                                     â”‚
â”‚     â””â”€â”€ éŸ³é¢‘æœåŠ¡æ¨¡å—ç”Ÿæˆ                                     â”‚
â”‚                                                             â”‚
â”‚  4. æ§åˆ¶å±‚ (process-audio.js)                               â”‚
â”‚     â”œâ”€â”€ ä¸€é”®å¼å®Œæ•´æµç¨‹æ§åˆ¶                                   â”‚
â”‚     â”œâ”€â”€ ä¾èµ–æ£€æŸ¥å’Œé”™è¯¯å¤„ç†                                   â”‚
â”‚     â””â”€â”€ è¯¦ç»†æ—¥å¿—å’ŒæŠ¥å‘Šç”Ÿæˆ                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ ä¾èµ–è¦æ±‚

### å¿…éœ€è½¯ä»¶
- **Node.js** >= 14.0.0
- **FFmpeg** (ç”¨äºéŸ³é¢‘è½¬æ¢)
  ```bash
  # macOS
  brew install ffmpeg
  
  # Ubuntu/Debian
  sudo apt-get install ffmpeg
  
  # Windows
  # ä¸‹è½½å¹¶å®‰è£… https://ffmpeg.org/download.html
  ```

### å¿…éœ€çš„ npm åŒ…
å·²åŒ…å«åœ¨é¡¹ç›®ä¾èµ–ä¸­ï¼š
- `@aws-sdk/client-s3` - R2 ä¸Šä¼ 
- `dotenv` - ç¯å¢ƒå˜é‡ç®¡ç†

### ç¯å¢ƒé…ç½®
åœ¨ `.env.local` ä¸­é…ç½®ä»¥ä¸‹å˜é‡ï¼š
```env
# Cloudflare R2 é…ç½®
R2_ACCOUNT_ID=your_account_id
R2_ACCESS_KEY_ID=your_access_key
R2_SECRET_ACCESS_KEY=your_secret_key
R2_BUCKET_NAME=your_bucket_name
R2_ENDPOINT=https://your_endpoint.r2.dev
```

## ğŸ›  ä½¿ç”¨æ–¹æ³•

### å®Œæ•´æµç¨‹å‘½ä»¤

#### 1. ä¸€é”®å®Œæ•´å¤„ç†
```bash
npm run audio:process
```
æ‰§è¡Œå®Œæ•´æµç¨‹ï¼šè½¬æ¢ â†’ ä¸Šä¼  â†’ é…ç½®æ›´æ–°

#### 2. å¸¦é€‰é¡¹çš„å¤„ç†
```bash
# è·³è¿‡è½¬æ¢ï¼Œåªä¸Šä¼ ç°æœ‰ AAC æ–‡ä»¶
npm run audio:process -- --skip-convert

# è½¬æ¢å¹¶ä¸Šä¼ ï¼ŒéªŒè¯ç»“æœ
npm run audio:process -- --validate

# å®Œæ•´æµç¨‹ï¼Œå®Œæˆåæ¸…ç†ä¸´æ—¶æ–‡ä»¶
npm run audio:process -- --clean

# æ¨¡æ‹Ÿè¿è¡Œï¼ˆä¸æ‰§è¡Œå®é™…æ“ä½œï¼‰
npm run audio:process -- --dry-run
```

### åˆ†æ­¥æ‰§è¡Œå‘½ä»¤

#### 1. ä»…éŸ³é¢‘è½¬æ¢
```bash
npm run audio:convert
```
- å°† `public/sounds/*.mp3` è½¬æ¢ä¸º AAC
- è¾“å‡ºåˆ° `temp/sounds-aac/`
- ç”Ÿæˆè½¬æ¢æŠ¥å‘Š

#### 2. ä»…äº‘ç«¯ä¸Šä¼ 
```bash
npm run audio:upload
```
- ä¸Šä¼  `temp/sounds-aac/*.aac` åˆ° R2
- è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨æ–‡ä»¶
- ç”Ÿæˆ URL æ˜ å°„æ–‡ä»¶

#### 3. ä»… URL ç®¡ç†
```bash
npm run audio:urls
```
- éªŒè¯ä¸Šä¼ çš„æ–‡ä»¶å¯è®¿é—®æ€§
- ç”Ÿæˆå‰ç«¯é…ç½®æ–‡ä»¶
- åˆ›å»ºéŸ³é¢‘æœåŠ¡æ¨¡å—

## ğŸ“ æ–‡ä»¶ç»“æ„

```
scripts/
â”œâ”€â”€ process-audio.js              # ä¸»æ§åˆ¶è„šæœ¬
â”œâ”€â”€ audio-pipeline/
â”‚   â”œâ”€â”€ convert.js               # éŸ³é¢‘æ ¼å¼è½¬æ¢
â”‚   â”œâ”€â”€ upload.js                # R2 äº‘ç«¯ä¸Šä¼ 
â”‚   â””â”€â”€ url-generator.js         # URL ç®¡ç†
â”œâ”€â”€ audio-urls.json              # URL æ˜ å°„ (è‡ªåŠ¨ç”Ÿæˆ)
â””â”€â”€ AUDIO_SERVICE_DOCS.md        # æœåŠ¡æ–‡æ¡£ (è‡ªåŠ¨ç”Ÿæˆ)

src/
â”œâ”€â”€ config/
â”‚   â””â”€â”€ audio-config.json        # å‰ç«¯éŸ³é¢‘é…ç½® (è‡ªåŠ¨ç”Ÿæˆ)
â””â”€â”€ services/
    â””â”€â”€ audio-service.js         # éŸ³é¢‘æœåŠ¡æ¨¡å— (è‡ªåŠ¨ç”Ÿæˆ)

temp/                            # ä¸´æ—¶æ–‡ä»¶ç›®å½•
â””â”€â”€ sounds-aac/                  # è½¬æ¢åçš„ AAC æ–‡ä»¶
```

## ğŸ¯ è¾“å‡ºæ–‡ä»¶è¯´æ˜

### 1. `src/config/audio-config.json`
å‰ç«¯éŸ³é¢‘é…ç½®æ–‡ä»¶ï¼ŒåŒ…å«ï¼š
- éŸ³é¢‘æ–‡ä»¶å…ƒæ•°æ®
- äº‘ç«¯å’Œæœ¬åœ° URL æ˜ å°„
- åˆ†ç±»ä¿¡æ¯
- R2 é…ç½®

### 2. `src/services/audio-service.js`
éŸ³é¢‘æœåŠ¡æ¨¡å—ï¼Œæä¾›ï¼š
- éŸ³é¢‘æ–‡ä»¶åŠ è½½å’Œç¼“å­˜
- URL è·å–å’Œç®¡ç†
- åˆ†ç±»æŸ¥è¯¢åŠŸèƒ½
- é”™è¯¯å¤„ç†å’Œå›é€€

### 3. `scripts/audio-urls.json`
ç®€å•çš„ URL æ˜ å°„æ–‡ä»¶ï¼š
```json
{
  "rain": "https://your-r2.dev/sounds/rain.aac",
  "ocean": "https://your-r2.dev/sounds/ocean.aac"
}
```

## ğŸ”§ é«˜çº§é€‰é¡¹

### å‘½ä»¤è¡Œå‚æ•°
```bash
--skip-convert     # è·³è¿‡éŸ³é¢‘æ ¼å¼è½¬æ¢
--skip-upload      # è·³è¿‡äº‘ç«¯ä¸Šä¼ 
--skip-urls        # è·³è¿‡URLç®¡ç†å’Œå‰ç«¯é…ç½®
--validate         # éªŒè¯ä¸Šä¼ çš„æ–‡ä»¶å¯è®¿é—®æ€§
--clean            # å®Œæˆåæ¸…ç†ä¸´æ—¶æ–‡ä»¶
--verbose          # æ˜¾ç¤ºè¯¦ç»†æ—¥å¿—
--dry-run          # æ¨¡æ‹Ÿè¿è¡Œï¼Œä¸æ‰§è¡Œå®é™…æ“ä½œ
-h, --help         # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

### ç¯å¢ƒå˜é‡è¦†ç›–
å¯é€šè¿‡ç¯å¢ƒå˜é‡ä¸´æ—¶è¦†ç›–é…ç½®ï¼š
```bash
R2_BUCKET_NAME=test-bucket npm run audio:process
```

## ğŸ“Š å¤„ç†æŠ¥å‘Š

æ¯æ¬¡è¿è¡Œéƒ½ä¼šç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼š

### è½¬æ¢æŠ¥å‘Š
- `scripts/audio-pipeline/conversion-report.json`
- åŒ…å«å‹ç¼©ç‡ã€å¤„ç†æ—¶é—´ç­‰ç»Ÿè®¡ä¿¡æ¯

### ä¸Šä¼ æŠ¥å‘Š
- `scripts/audio-pipeline/upload-report.json`
- åŒ…å«ä¸Šä¼ é€Ÿåº¦ã€æˆåŠŸç‡ç­‰ä¿¡æ¯

### URL ç®¡ç†æŠ¥å‘Š
- `scripts/audio-pipeline/url-management-report.json`
- åŒ…å« URL éªŒè¯ç»“æœå’Œé…ç½®ä¿¡æ¯

### æ€»ä½“æŠ¥å‘Š
- `scripts/pipeline-report.json`
- å®Œæ•´æµç¨‹çš„æ±‡æ€»æŠ¥å‘Š

## ğŸµ å‰ç«¯é›†æˆ

### ä½¿ç”¨éŸ³é¢‘æœåŠ¡
```javascript
import { audioService } from '@/services/audio-service';

// è·å–éŸ³é¢‘ URL
const audioUrl = audioService.getAudioUrl('rain');

// é¢„åŠ è½½éŸ³é¢‘
const audio = await audioService.preloadAudio('ocean');
audio.play();

// æŒ‰åˆ†ç±»è·å–éŸ³é¢‘
const focusSounds = audioService.getSoundsByCategory('Focus');
```

### æ›´æ–° ASMR Music ç»„ä»¶
ç”Ÿæˆçš„é…ç½®æ–‡ä»¶å¯ä»¥ç›´æ¥åœ¨ç°æœ‰çš„ ASMR Music é¡µé¢ä¸­ä½¿ç”¨ï¼Œåªéœ€è¦å°†éŸ³é¢‘ URL ä»æœ¬åœ°è·¯å¾„æ›¿æ¢ä¸ºäº‘ç«¯ URLã€‚

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç½‘ç»œç¯å¢ƒ
- ä¸Šä¼ å¤§æ–‡ä»¶éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
- æµ·å¤– R2 å¯èƒ½éœ€è¦ä»£ç†

### 2. æˆæœ¬æ§åˆ¶
- R2 å­˜å‚¨è´¹ç”¨æŒ‰æ–‡ä»¶å¤§å°è®¡ç®—
- å»ºè®®ç›‘æ§å­˜å‚¨ä½¿ç”¨æƒ…å†µ

### 3. ç¼“å­˜ç­–ç•¥
- äº‘ç«¯æ–‡ä»¶è®¾ç½®äº† 1 å¹´ç¼“å­˜æœŸ
- æ›´æ–°æ–‡ä»¶éœ€è¦æ›´æ”¹æ–‡ä»¶å

### 4. é”™è¯¯å¤„ç†
- è½¬æ¢å¤±è´¥ä¼šè‡ªåŠ¨é‡è¯•
- ä¸Šä¼ å¤±è´¥ä¼šä¿ç•™æœ¬åœ°æ–‡ä»¶
- æ”¯æŒæ–­ç‚¹ç»­ä¼ 

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### FFmpeg æœªæ‰¾åˆ°
```bash
Error: FFmpeg not found
```
**è§£å†³æ–¹æ¡ˆ**: å®‰è£… FFmpeg
```bash
brew install ffmpeg  # macOS
```

#### R2 è®¤è¯å¤±è´¥
```bash
Error: Access Denied
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ `.env.local` ä¸­çš„ R2 é…ç½®

#### ç½‘ç»œè¿æ¥è¶…æ—¶
```bash
Error: Network timeout
```
**è§£å†³æ–¹æ¡ˆ**: æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œè€ƒè™‘ä½¿ç”¨ä»£ç†

#### å­˜å‚¨ç©ºé—´ä¸è¶³
```bash
Error: No space left
```
**è§£å†³æ–¹æ¡ˆ**: æ¸…ç† `temp/` ç›®å½•æˆ–å¢åŠ ç£ç›˜ç©ºé—´

### è°ƒè¯•æŠ€å·§

#### 1. è¯¦ç»†æ—¥å¿—
```bash
npm run audio:process -- --verbose
```

#### 2. æ¨¡æ‹Ÿè¿è¡Œ
```bash
npm run audio:process -- --dry-run
```

#### 3. åˆ†æ­¥è°ƒè¯•
```bash
npm run audio:convert   # å…ˆæµ‹è¯•è½¬æ¢
npm run audio:upload    # å†æµ‹è¯•ä¸Šä¼ 
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

### è½¬æ¢ä¼˜åŒ–
- AAC æ ¼å¼æ¯” MP3 å‹ç¼©ç‡æ›´é«˜
- é»˜è®¤ä½¿ç”¨ 128kbpsï¼Œå¹³è¡¡è´¨é‡å’Œå¤§å°
- æ”¯æŒæ‰¹é‡å¹¶è¡Œå¤„ç†

### ä¸Šä¼ ä¼˜åŒ–
- è‡ªåŠ¨è·³è¿‡å·²å­˜åœ¨çš„æ–‡ä»¶
- æ”¯æŒæ–­ç‚¹ç»­ä¼ 
- æ™ºèƒ½é‡è¯•æœºåˆ¶

### ç¼“å­˜ä¼˜åŒ–
- R2 æ–‡ä»¶è®¾ç½®é•¿æœŸç¼“å­˜
- å‰ç«¯éŸ³é¢‘æœåŠ¡æä¾›æœ¬åœ°ç¼“å­˜
- æ”¯æŒé¢„åŠ è½½å’Œæ‡’åŠ è½½ç­–ç•¥

## ğŸ”„ æ›´æ–°å’Œç»´æŠ¤

### å®šæœŸä»»åŠ¡
1. **æ£€æŸ¥å­˜å‚¨ä½¿ç”¨æƒ…å†µ**
   - ç›‘æ§ R2 å­˜å‚¨è´¹ç”¨
   - æ¸…ç†æ— ç”¨æ–‡ä»¶

2. **æ›´æ–°éŸ³é¢‘æ–‡ä»¶**
   - æ·»åŠ æ–°éŸ³é¢‘åˆ° `public/sounds/`
   - è¿è¡Œ `npm run audio:process`

3. **å¤‡ä»½é…ç½®**
   - å®šæœŸå¤‡ä»½ç”Ÿæˆçš„é…ç½®æ–‡ä»¶
   - ç‰ˆæœ¬æ§åˆ¶ç®¡ç†

### æ‰©å±•åŠŸèƒ½
- æ”¯æŒæ›´å¤šéŸ³é¢‘æ ¼å¼
- æ·»åŠ éŸ³é¢‘è´¨é‡é€‰æ‹©
- å®ç°å¢é‡æ›´æ–°æœºåˆ¶
- é›†æˆ CDN åŠ é€Ÿ

---

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç”Ÿæˆçš„æŠ¥å‘Šæ–‡ä»¶
2. ä½¿ç”¨ `--verbose` å‚æ•°è·å–è¯¦ç»†æ—¥å¿—
3. æ£€æŸ¥ç¯å¢ƒé…ç½®å’Œä¾èµ–å®‰è£…